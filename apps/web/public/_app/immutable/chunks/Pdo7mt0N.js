import{C as N,b as A,G as D}from"./DoR1-v3w.js";import{D as S}from"./Nk41YHiH.js";import{X as h}from"./B_g0vce7.js";const w=[];class _ extends S{constructor(){super(N,w)}addCategory(e){e.id||(e.id=crypto.randomUUID()),this.update(t=>[...t,e])}removeCategory(e){this.update(t=>{const a=t.findIndex(r=>r.id===e);return a>-1&&t.splice(a,1),t})}removeCategoriesBySubject(e){this.update(t=>t.filter(a=>a.subjectId!==e))}updateCategory(e){this.update(t=>t.map(a=>a.id===e.id?e:a))}}const O=new _,W=[];class $ extends S{constructor(){super(A,W)}addConfig(e){e.id||(e.id=crypto.randomUUID()),this.update(t=>[...t,e])}removeConfig(e){this.update(t=>{const a=t.findIndex(r=>r.id===e);return a>-1&&t.splice(a,1),t})}removeConfigsBySubject(e){this.update(t=>t.filter(a=>a.subjectId!==e))}updateConfig(e){this.update(t=>t.map(a=>a.id===e.id?e:a))}getConfigBySubject(e){return h(this).find(a=>a.subjectId===e)}static getGradeScales(){return{chilean:{minGrade:1,passingGrade:4,maxGrade:7,name:"Chilena (1.0 - 7.0)"},utfsm:{minGrade:0,passingGrade:55,maxGrade:100,name:"UTFSM (0.0 - 100.0)"},european:{minGrade:1,passingGrade:5,maxGrade:10,name:"Europea (1.0 - 10.0)"},custom:{minGrade:0,passingGrade:60,maxGrade:100,name:"Personalizada"}}}}const q=new $;class F{calculate(e,t,a){const r=this.getGradesBySubject(t,e.id),i=this.getCategoriesBySubject(e.id),n=this.getSubjectConfig(e.id);if(!n)return this.createErrorResult(e.id,"No se encontró configuración para esta materia");const d=this.calculateCurrentGrade(r,i);switch(a){case"LP_MIN_PASSING_DISTANCE":return this.calculateWithLinearProgramming(e.id,r,i,n,d);default:return this.createErrorResult(e.id,`Método de cálculo desconocido: ${a}`)}}calculateCurrentGrade(e,t){if(e.length===0)return 0;const a=e.filter(i=>i.value!==void 0&&i.value!==null);if(a.length===0)return 0;let r=0;for(const i of a){const n=i.value,d=i.weight/100;let u=1;if(i.categoryId){const G=t.find(y=>y.id===i.categoryId);G&&(u=G.weight/100)}const l=n*d*u;r+=l}return r}calculateWithLinearProgramming(e,t,a,r,i){var v;const n=r.passingGrade,d=t.filter(s=>s.value===void 0||s.value===null);if(d.length===0)return{subjectId:e,currentGrade:i,canPass:i>=n,requiredGrades:[],recommendations:i>=n?["¡Felicitaciones! Ya tienes la nota suficiente para aprobar."]:["No es posible mejorar la nota con las evaluaciones actuales."],calculatedAt:new Date().toISOString()};const u=this.calculateCurrentContribution(t,a),l=n-u;if(l<=0)return{subjectId:e,currentGrade:i,canPass:!0,requiredGrades:d.map(s=>({categoryId:s.categoryId||"no-category",categoryName:this.getGradeName(s,a),requiredValue:r.minGrade,achievable:r.minGrade<=r.maxGrade,description:`Nota mínima sugerida: ${r.minGrade.toFixed(1)} en "${s.description}"`})),recommendations:["Ya tienes suficiente nota para aprobar. Las notas sugeridas son mínimas."],calculatedAt:new Date().toISOString()};const G=d.map(s=>{var o;const c=s.weight/100,p=s.categoryId?(((o=a.find(m=>m.id===s.categoryId))==null?void 0:o.weight)||100)/100:1;return c*p});if(G.reduce((s,c)=>s+c,0)===0)return{subjectId:e,currentGrade:i,canPass:!1,requiredGrades:[],recommendations:["No es posible aprobar: las evaluaciones restantes no tienen peso."],calculatedAt:new Date().toISOString()};const b=[],g=[],x=l/d.length;let C=0;for(let s=0;s<d.length;s++){const c=d[s],p=G[s];let o=p>0?x/p:r.maxGrade;o>r.maxGrade&&(o=r.maxGrade),o<r.minGrade&&(o=r.minGrade);const m=this.getGradeName(c,a),j=c.categoryId&&((v=a.find(E=>E.id===c.categoryId))==null?void 0:v.name)||"Sin categoría";b.push({categoryId:c.categoryId||"no-category",categoryName:m,requiredValue:Math.round(o*10)/10,achievable:o<=r.maxGrade,description:`Se necesita una nota de ${o.toFixed(1)} en "${c.description}" (${j})`}),C+=o*p,o>=r.maxGrade*.9?g.push(`🔥 ${m}: Nota muy alta requerida (${o.toFixed(1)})`):o>=r.passingGrade*1.2?g.push(`📈 ${m}: Nota alta requerida (${o.toFixed(1)})`):g.push(`✅ ${m}: Nota moderada requerida (${o.toFixed(1)})`)}const I=u+C>=n&&b.every(s=>s.requiredValue<=r.maxGrade);return I?g.unshift("✅ Es posible aprobar con las notas calculadas"):g.unshift("❌ No es posible aprobar con las evaluaciones restantes"),{subjectId:e,currentGrade:i,canPass:I,requiredGrades:b,recommendations:g,calculatedAt:new Date().toISOString()}}calculateCurrentContribution(e,t){var i;let a=0;const r=e.filter(n=>n.value!==void 0&&n.value!==null);for(const n of r){const d=n.weight/100,u=n.categoryId?(((i=t.find(l=>l.id===n.categoryId))==null?void 0:i.weight)||100)/100:1;a+=n.value*d*u}return a}getGradeName(e,t){var r;return`${e.categoryId&&((r=t.find(i=>i.id===e.categoryId))==null?void 0:r.name)||"Sin categoría"} - ${e.description||"Nota"}`}createErrorResult(e,t){return{subjectId:e,currentGrade:0,canPass:!1,requiredGrades:[],recommendations:[t],calculatedAt:new Date().toISOString()}}getGradesBySubject(e,t){return h(e).filter(r=>r.subjectId===t)}getCategoriesBySubject(e){return h(O).filter(a=>a.subjectId===e)}getSubjectConfig(e){return h(q).find(a=>a.subjectId===e)||null}getSubjectStatus(e,t,a){return e>=t?"Aprobado":a?"En curso":"Reprobado"}}const P=new F,R=[];class T extends S{constructor(){super(D,R)}addGrade(e){e.id||(e.id=crypto.randomUUID()),this.update(t=>[...t,e])}removeGrade(e){this.update(t=>{const a=t.findIndex(r=>r.id===e);return a>-1&&t.splice(a,1),t})}removeGradesBySubject(e){this.update(t=>t.filter(a=>a.subjectId!==e))}updateGrade(e){this.update(t=>t.map(a=>a.id===e.id?e:a))}getGradesBySubject(e){return h(this).filter(a=>a.subjectId===e)}getGradesCalculations(e,t){const a={};for(const r of e)a[r.id]=P.calculate(r,this,t);return a}getStats(e){const t=Object.keys(e).length,a=Object.values(e).reduce((n,d)=>n+d.currentGrade,0)/t||0,r=Object.values(e).filter(n=>n.canPass).length,i=t-r;return{totalSubjects:t,averageGrade:a,passingSubjects:r,failingSubjects:i}}}const M=new T;export{$ as S,q as a,O as b,M as c,P as g};
